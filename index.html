<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korpstur Infoapp</title>
    <!-- Last inn Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Last inn React og ReactDOM fra CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Last inn Babel for å tolke JSX i nettleseren (kun for enkel deployment) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- FIX: Byttet fra lucide-react UMD (som feilet med forwardRef) til det rene lucide-biblioteket.
        Dette gir tilgang til ikon-dataene via den globale variabelen 'lucide'. -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Konfigurer Tailwind til å bruke Inter-fonten og egendefinerte farger -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
          }
        }
      }
    </script>
    <style>
      /* Skjul scrollbar for kategori-knappene, men behold funksjonaliteten */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none; /* IE and Edge */
          scrollbar-width: none; /* Firefox */
      }
      /* Enkel animasjon for å vise/skjule svar */
      @keyframes fadeInDown {
          from { opacity: 0; transform: translateY(-5px); }
          to { opacity: 1; transform: translateY(0); }
      }
      .animate-in {
          animation: fadeInDown 0.3s ease-out;
      }
    </style>
</head>
<body class="bg-slate-50 font-sans">

    <div id="root"></div>

    <script type="text/babel">
      
      // --- HJELPEKOMPONENT FOR Å RENDRE LUCIDE IKONER FRA RAW DATA ---
      // Denne komponenten henter SVG-banene fra den globale 'lucide' variabelen og tegner ikonet.
      const IconSvg = ({ name, className }) => {
        // Sikrer at lucide er definert globalt (fra CDN-filen)
        if (typeof lucide === 'undefined' || !lucide.icons) {
            console.error("Lucide icons library is not loaded.");
            return null; 
        }

        // Konverterer navnet til PascalCase for oppslag (f.eks. 'bus' blir 'Bus')
        const iconName = name.charAt(0).toUpperCase() + name.slice(1);
        const iconData = lucide.icons[iconName];

        if (!iconData) {
            console.warn(`Icon data not found for: ${iconName}`);
            return null;
        }

        // De siste elementene i ikondata-arrayet er vanligvis ikonnavn og attributter, vi trenger bare stiene.
        const pathData = iconData.slice(0, iconData.length - 2);

        return (
          <svg 
            className={className} 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            strokeWidth="2" 
            strokeLinecap="round" 
            strokeLinejoin="round"
          >
            {pathData.map((attrs, index) => {
                // attrs[1] inneholder de faktiske SVG-attributtene
                return <path key={index} {...attrs[1]} />;
            })}
          </svg>
        );
      };
      // --- SLUTT PÅ IKON HJELPEKOMPONENT ---
      
      // --- KONFIGURASJON ---

      // Lim inn din publiserte CSV-lenke fra Google Sheets her
      const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTEiz6lnSo33ak5q90gZflUaxzef9_B_cF5dkXkqQoafpuy4Cyd6aaBaX8bfvKiuRVGY08usZeOV3II/pub?output=csv'; 

      // --- RESERVE-DATA (Brukes hvis Google Sheet ikke er koblet til ennå) ---
      const INITIAL_DATA = [
        {
          id: 1,
          category: 'Reise',
          question: 'Eksempel: Når går bussen? (Data fra kode)',
          answer: 'Dette er testdata. Husk å bytte ut GOOGLE_SHEET_CSV_URL med din egen lenke!',
          keywords: 'buss test'
        },
        {
          id: 2,
          category: 'Pakkeliste',
          question: 'Hvordan legger jeg inn min egen info?',
          answer: 'Følg instruksjonene for Google Sheets og lim inn CSV-lenken i koden.',
          keywords: 'hjelp info'
        },
        {
          id: 3,
          category: 'Program',
          question: 'Hvor skal vi spille konsert?',
          answer: 'Vi skal spille på bytorget klokken 14:00. Møt opp i full uniform.',
          keywords: 'konsert program'
        },
        {
          id: 4,
          category: 'Kontakt',
          question: 'Hvem skal jeg ringe ved akutt krise?',
          answer: 'Ring reiseleder, tlf: 123 45 678. Ved medisinske nødsituasjoner, ring det lokale nødnummeret 112.',
          keywords: 'krise nødnummer'
        }
      ];

      // --- HJELPEFUNKSJON FOR Å LESE CSV (Komma-separert fil) ---
      const parseCSV = (text) => {
        const rows = text.split('\n').map(row => row.trim()).filter(row => row.length > 0);
        if (rows.length < 2) return []; // Ingen data utover header

        const headers = rows[0].split(',').map(h => h.trim().toLowerCase());
        
        return rows.slice(1).map((row, index) => {
          // Denne regex-en splitter på komma, men ignorerer komma inne i hermetegn (f.eks "Hei, her er jeg")
          const values = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
          
          const entry = {};
          headers.forEach((header, i) => {
            let value = values[i] ? values[i].trim() : '';
            if (value.startsWith('"') && value.endsWith('"')) {
              value = value.slice(1, -1);
            }
            value = value.replace(/""/g, '"');
            entry[header] = value;
          });
          
          return {
            id: index + 100,
            category: entry.category || 'Info',
            question: entry.question || 'Spørsmål mangler',
            answer: entry.answer || 'Svar mangler',
            keywords: entry.keywords || ''
          };
        });
      };

      // --- APP KOMPONENTER ---

      const InfoCard = ({ item }) => {
        const [isOpen, setIsOpen] = React.useState(false);

        const getIcon = (cat) => {
          const c = cat?.toLowerCase() || '';
          // Bruker IconSvg med strengnavn
          const baseClass = "w-5 h-5";

          if (c.includes('reise') || c.includes('buss')) return <IconSvg name="bus" className={`${baseClass} text-blue-500`} />;
          if (c.includes('fly')) return <IconSvg name="plane" className={`${baseClass} text-sky-500`} />;
          if (c.includes('overnatting') || c.includes('hotell')) return <IconSvg name="map-pin" className={`${baseClass} text-red-500`} />;
          if (c.includes('pakke') || c.includes('uniform')) return <IconSvg name="shirt" className={`${baseClass} text-purple-500`} />;
          if (c.includes('kontakt') || c.includes('nød')) return <IconSvg name="phone" className={`${baseClass} text-green-500`} />;
          if (c.includes('program') || c.includes('spille')) return <IconSvg name="calendar" className={`${baseClass} text-orange-500`} />;
          if (c.includes('mat') || c.includes('servering')) return <IconSvg name="utensils" className={`${baseClass} text-yellow-600`} />;
          return <IconSvg name="info" className={`${baseClass} text-gray-500`} />;
        };

        return (
          <div 
            className="bg-white mb-3 rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer transition-all hover:shadow-md"
            onClick={() => setIsOpen(!isOpen)}
          >
            <div className="p-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="bg-gray-50 p-2 rounded-full">
                  {getIcon(item.category)}
                </div>
                <h3 className="font-semibold text-gray-800 text-sm sm:text-base pr-2">{item.question}</h3>
              </div>
              {/* Bruker IconSvg for piler også */}
              {isOpen 
                ? <IconSvg name="chevron-up" className="text-gray-400 w-5 h-5 flex-shrink-0" /> 
                : <IconSvg name="chevron-down" className="text-gray-400 w-5 h-5 flex-shrink-0" />
              }
            </div>
            
            {isOpen && (
              <div className="bg-blue-50 px-4 py-4 border-t border-blue-100 text-gray-700 text-sm leading-relaxed animate-in">
                {item.answer}
              </div>
            )}
          </div>
        );
      };

      const App = () => {
        const [searchTerm, setSearchTerm] = React.useState('');
        const [selectedCategory, setSelectedCategory] = React.useState('Alle');
        const [data, setData] = React.useState(INITIAL_DATA);
        const [loading, setLoading] = React.useState(false);
        const [error, setError] = React.useState(null);

        // Last inn data fra Google Sheets når appen starter
        React.useEffect(() => {
          if (GOOGLE_SHEET_CSV_URL) {
            setLoading(true);
            fetch(GOOGLE_SHEET_CSV_URL)
              .then(response => response.text())
              .then(csvText => {
                const parsedData = parseCSV(csvText);
                if (parsedData.length > 0) {
                  setData(parsedData);
                }
                setLoading(false);
              })
              .catch(err => {
                console.error("Kunne ikke laste regneark:", err);
                setError("Kunne ikke hente oppdatert info. Viser lagret info.");
                setLoading(false);
              });
          }
        }, []);

        // Hent ut unike kategorier fra dataen
        // Filter ut tomme kategorier i tilfelle CSV-parsing returnerer null/tomme strenger
        const categories = ['Alle', ...new Set(data.map(item => item.category).filter(c => c && c.trim()))];

        // Filtrer data basert på søk og kategori
        const filteredData = React.useMemo(() => {
          return data.filter(item => {
            const searchTerms = searchTerm.toLowerCase().split(/\s+/).filter(t => t.length > 0);
            
            const matchesSearch = searchTerms.length === 0 || searchTerms.every(term => 
              (item.question?.toLowerCase() || '').includes(term) || 
              (item.answer?.toLowerCase() || '').includes(term) ||
              (item.keywords?.toLowerCase() || '').includes(term)
            );
            
            const matchesCategory = selectedCategory === 'Alle' || item.category === selectedCategory;

            return matchesSearch && matchesCategory;
          });
        }, [searchTerm, selectedCategory, data]);

        return (
          <div className="min-h-screen bg-slate-50 font-sans pb-10">
            
            {/* Header */}
            <div className="bg-indigo-900 text-white pt-8 pb-12 px-6 rounded-b-[2.5rem] shadow-lg relative overflow-hidden">
              <div className="absolute top-0 right-0 p-4 opacity-10 transform rotate-12">
                {/* Bruker IconSvg for musikk-ikonet i bakgrunnen */}
                <IconSvg name="music" className="w-32 h-32" />
              </div>
              
              <div className="max-w-md mx-auto relative z-10 text-center">
                <div className="inline-flex items-center justify-center p-3 bg-white/10 rounded-full mb-4 backdrop-blur-sm border border-white/20">
                  <IconSvg name="music" className="text-yellow-400 w-8 h-8" />
                </div>
                <h1 className="text-3xl font-bold mb-2 tracking-tight">Korpstur 2024</h1>
                <p className="text-indigo-200 text-sm">Alt du lurer på, samlet på ett sted.</p>
              </div>
            </div>

            <div className="max-w-md mx-auto px-4 -mt-6 relative z-20">
              
              {/* Statusmeldinger (Laster / Feil) */}
              {loading && (
                <div className="bg-yellow-50 text-yellow-800 p-3 rounded-xl mb-4 text-sm text-center shadow-sm border border-yellow-100">
                  Henter oppdatert info fra styret...
                </div>
              )}
              
              {error && (
                <div className="bg-red-50 text-red-800 p-3 rounded-xl mb-4 text-sm flex items-center gap-2 border border-red-100">
                  <IconSvg name="alert-circle"
